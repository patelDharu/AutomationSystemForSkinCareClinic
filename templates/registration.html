{% extends "layout.html" %}
{% block content %}
<div class="row">
    
    <div class="col-12 mb-4">
        <div class="modern-card p-3 bg-white border-left-primary">
            <form action="/" method="POST" class="row align-items-center">
                <div class="col-md-8">
                    <label class="small fw-bold text-primary mb-1">OLD PATIENT? SEARCH HERE:</label>
                    <input type="text" name="search_phone" class="form-control" placeholder="Enter Phone Number to autofill details..." required>
                </div>
                <div class="col-md-4 pt-4">
                    <button type="submit" name="btn_search" class="btn btn-outline-primary w-100">
                        <i class="bi bi-search"></i> Search Patient
                    </button>
                </div>
            </form>
            {% if patient %}
                <div class="alert alert-success mt-2 mb-0 py-2 small">
                    <i class="bi bi-check-circle"></i> Patient Found! Details loaded below. Update if needed.
                </div>
            {% endif %}
        </div>
    </div>

    <div class="col-12">
        <div class="modern-card">
            <div class="card-header-custom">
                <i class="bi bi-person-lines-fill text-primary"></i>
                <h4 class="m-0">
                    {% if patient %} Update Patient & Add Visit {% else %} New Registration & Checkup {% endif %}
                </h4>
            </div>
            <div class="card-body p-4">
                <form action="/add" method="POST">
                    
                    <h6 class="text-uppercase text-primary fw-bold mb-3 border-bottom pb-2">Patient Details</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <label class="small text-muted">Full Name *</label>
                            <input type="text" name="name" class="form-control" required value="{{ patient.name if patient else '' }}">
                        </div>
                        <div class="col-md-3">
                            <label class="small text-muted">Phone Number *</label>
                            <input type="text" name="phone" class="form-control" required value="{{ patient.phone if patient else '' }}">
                        </div>
                        <div class="col-md-2">
                            <label class="small text-muted">Age</label>
                            <input type="number" name="age" class="form-control" value="{{ patient.age if patient else '' }}">
                        </div>
                        <div class="col-md-4">
                            <label class="small text-muted">Address</label>
                            <input type="text" name="address" class="form-control" value="{{ patient.address if patient else '' }}">
                        </div>
                        <div class="col-md-12">
                            <label class="small text-muted">Family History</label>
                            <input type="text" name="family_history" class="form-control" value="{{ patient.family_history if patient else '' }}">
                        </div>
                    </div>

                    <h6 class="text-uppercase text-primary fw-bold mb-3 border-bottom pb-2">Current Visit Data</h6>
                    <div class="row g-3">
                        <div class="col-md-12">
                            <label class="small text-muted fw-bold">Complaint (C/O)</label>
                            <input type="text" name="complaint" class="form-control">
                        </div>
                        
                        <div class="col-md-6">
                            <label class="small text-muted fw-bold text-danger">Diagnosis</label>
                            <input type="text" name="diagnosis" class="form-control" placeholder="e.g. Acne, Melasma...">
                        </div>

                        <div class="col-md-6">
                            <label class="small text-muted fw-bold text-primary">Treatment / Procedure</label>
                            <input type="text" name="procedure" class="form-control" placeholder="Type treatment name..." required>
                        </div>

                        <div class="col-md-6">
                            <label class="small text-muted fw-bold">Medicine Box</label>
                            <textarea name="medicine_box" class="form-control" rows="4" style="background:#fffbf2; font-family:monospace;"></textarea>
                        </div>
                        <div class="col-md-6">
                            <label class="small text-muted fw-bold">Advice</label>
                            <textarea name="advice" class="form-control" rows="4"></textarea>
                        </div>

                        <div class="col-md-6">
                            <label class="small text-muted">Next Treatment Plan</label>
                            <input type="text" name="next_plan" class="form-control">
                        </div>

                        <div class="col-md-6">
                            <label class="small text-muted fw-bold text-success">Next Appointment Date</label>
                            <input type="date" name="next_appt_date" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="text-end mt-4">
                        <button type="submit" class="btn btn-primary-custom px-5 py-2">
                            {% if patient %} Update & Save Visit {% else %} Save New Record {% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}